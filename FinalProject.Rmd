---
title: "Final Project"
author: "abcd"
date: "today"
output: html_document
---

```{r}
library(tidyverse)
library(dplyr)
library(ggplot2)
library(countrycode)
library(ggthemes)
library(ggpubr)
require(maps)
require(viridis)

```


```{r include=FALSE}
salaries = read.csv("ds_salaries.csv")
```



#Top 3 jobs most appear
```{r}
salaries %>% group_by(job_title) %>% count() %>% arrange(desc(n)) %>% head(3)
```


# avg salry all over the world
```{r include=FALSE}
country_employee = salaries$employee_residence

salaries$country_employee = countrycode(country_employee, "iso2c", "country.name")

salaries %>% group_by(country_employee) %>% summarise(avg_salary = mean(salary_in_usd))

```

```{r, fig.height=8, fig.width=15, warning=FALSE}
world_map <- map_data("world")
world_salaries <-salaries %>% group_by(country_employee) %>% summarise(avg_salary = mean(salary_in_usd))

# Changing the data manaually so that it matches

setdiff(world_salaries$country_employee, world_map$region)

world_salaries[world_salaries == "United States"] <- "USA"
world_salaries[world_salaries == "Czechia"] <- "Czech Republic"
#world_salaries[world_salaries == "Hong Kong SAR China"] <- "China"
world_salaries[world_salaries == "United Kingdom"] <- "UK"

countries_map <- right_join(world_salaries, world_map, by = c("country_employee"="region"))

ggplot(countries_map, aes(long, lat, group = group))+
  geom_polygon(aes(fill = avg_salary ), color = "white")+ scale_fill_viridis_c(option = "B") 

```

# ratio between company_size with remote_ratio
# Compare on-shore and remote salary
```{r, warning=FALSE, fig.height=8, fig.width=15}
salaries$remote_ratio[salaries$remote_ratio == '100'] <- '100%'
salaries$remote_ratio[salaries$remote_ratio == '50'] <- '50%'
salaries$remote_ratio[salaries$remote_ratio == '0'] <- '0%'

par(mfrow = c(1, 2))
ggarrange (ggplot(salaries %>% group_by(company_size, remote_ratio)) + 
  geom_bar(mapping = aes(x = company_size, fill = remote_ratio), position = "dodge"),

ggplot(salaries %>% group_by(company_size,remote_ratio) %>% summarize (avg_salary = mean(salary_in_usd))) + 
  geom_col(mapping = aes(x = company_size, y = avg_salary, fill = remote_ratio), position = "dodge"), ncol = 2, nrow =2 )
```

#Which country hire people most


#the involution of exp_level via each year by salary (line graph, y = sal, x = year, color = exp_level)
```{r}
salary_explevel = salaries %>% group_by(work_year,experience_level) %>% summarize(avg_salary = mean(salary))

ggplot(salary_explevel, aes(x = work_year, y = avg_salary,color = experience_level))+ geom_line()
```
##I have no idea if company decrease man-power, increase salary